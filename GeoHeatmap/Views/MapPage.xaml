<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:maps="clr-namespace:Microsoft.Maui.Controls.Maps;assembly=Microsoft.Maui.Controls.Maps"
             xmlns:skia="clr-namespace:SkiaSharp.Views.Maui.Controls;assembly=SkiaSharp.Views.Maui.Controls"
             x:Class="GeoHeatmap.MapPage"
             Title="MainView">
  <Grid RowDefinitions="*,Auto">
    <!-- Map + Heat overlay -->
    <maps:Map x:Name="TheMap"
              Grid.Row="0"
              IsShowingUser="True"
              MapType="Street" />

    <skia:SKCanvasView x:Name="HeatCanvas"
                       Grid.Row="0"
                       ZIndex="1"
                       InputTransparent="True"
                       PaintSurface="OnPaintSurface" />

    <!-- Bottom control card (wrapping layout so nothing overflows) -->
    <Border Grid.Row="1"
            Margin="12"
            Padding="14"
            BackgroundColor="#F9FAFB"
            StrokeThickness="0">
      <Border.StrokeShape>
        <RoundRectangle CornerRadius="18" />
      </Border.StrokeShape>
      <Border.Shadow>
        <Shadow Radius="12" Opacity="0.25" Offset="0,4" />
      </Border.Shadow>

      <VerticalStackLayout Spacing="10">
        <!-- Status chips: wrap on small widths -->
        <FlexLayout Wrap="Wrap" Direction="Row" AlignItems="Center" JustifyContent="Start">
          <Border Padding="8,6" BackgroundColor="#ECEFF1" Margin="0,0,10,8">
            <Border.StrokeShape>
              <RoundRectangle CornerRadius="12" />
            </Border.StrokeShape>
            <HorizontalStackLayout Spacing="6">
              <Label Text="Samples:" FontAttributes="Bold"/>
              <Label Text="{Binding SamplesCount}"/>
            </HorizontalStackLayout>
          </Border>

          <Border Padding="8,6" BackgroundColor="#ECEFF1" Margin="0,0,10,8">
            <Border.StrokeShape>
              <RoundRectangle CornerRadius="12" />
            </Border.StrokeShape>
            <HorizontalStackLayout Spacing="6">
              <Label Text="Last fix (UTC):" FontAttributes="Bold"/>
              <Label Text="{Binding LastFixTimeUtc, StringFormat='{0:HH:mm:ss}'}" LineBreakMode="TailTruncation" />
            </HorizontalStackLayout>
          </Border>
        </FlexLayout>

        <!-- Buttons: wrap if they don't fit on one line, so Clear Data is always reachable -->
        <FlexLayout Wrap="Wrap" Direction="Row" JustifyContent="SpaceBetween" AlignItems="Center">
          <Button Text="Toggle Tracking" Command="{Binding ToggleTrackingCommand}" Margin="0,0,10,0" />
          <Button Text="Refresh Heatmap" Command="{Binding RefreshHeatmapCommand}" Margin="0,0,10,0" />
          <Button Text="Clear Data" Command="{Binding ClearDataCommand}" Margin="0,0,10,0" />
        </FlexLayout>
      </VerticalStackLayout>
    </Border>
  </Grid>
</ContentPage>